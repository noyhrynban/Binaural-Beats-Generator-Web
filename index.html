<!DOCTYPE html>
<html lang="en">

<head>
    <title>Binaural Beats Generator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> -->
</head>

<body>
    <div class="container pt-3">
        <div class="card">
            <div class="card-header">
                <h1>Binaural Beats Generator</h1>
            </div>

            <div class="card-body">
                <label for="volumeSelectRange" class="form-label">Volume: <span id="volumeDisplay"></span></label>
                <input type="range" class="form-range" id="volumeSelectRange" min="1" max="100" step="1" value="20"
                    oninput="changeVolume(this.value)">

                <label for="offsetSelectRange" class="form-label">Offset: <span id="offsetDisplay"></span> hz</label>
                <input type="range" class="form-range" id="offsetSelectRange" min="1" max="40" step="1" value="40"
                    oninput="changeOffset(this.value)">

                <label for="frequencySelectRange" class="form-label">Frequencies: <span
                        id="frequencyLeftDisplay"></span> hz , <span id="frequencyRightDisplay"></span> hz</label>
                <input type="range" class="form-range" id="frequencySelectRange" min="100" max="1500" step="10"
                    value="440" oninput="changeFrequency(this.value)">

                <div class="text-center">
                    <button type="button" class="btn btn-primary" id="startButton" onClick="startOsc();">Start</button>
                    <button type="button" class="btn btn-primary" id="stopButton" style="display: none"
                        onClick="off();">Stop</button>
                </div>
            </div>

            <div class="card-footer">
                <a rel="external" target="_blank" href="https://en.wikipedia.org/wiki/Beat_(acoustics)#Binaural_beats">
                    Binaural Beats - Wikipedia
                </a>
            </div>

        </div>
    </div>
</body>

<script>
    /* references:
    https://middleearmedia.com/controlling-web-audio-api-oscillators/
    https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/
*/

    var audioContext = new AudioContext();
    var oscillatorLeft;
    var oscillatorRight;
    var gainLeft, gainRight;
    const panLeft = new StereoPannerNode(audioContext, { pan: -1 });
    const panRight = new StereoPannerNode(audioContext, { pan: 1 });
    var frequency = 440;
    var offset = 40;
    var volume = 20;

    const startButton = document.querySelector('#startButton');
    const stopButton = document.querySelector('#stopButton');
    var frequencyLeftDisplay = document.querySelector('#frequencyLeftDisplay');
    var frequencyRightDisplay = document.querySelector('#frequencyRightDisplay');
    var offsetDisplay = document.querySelector('#offsetDisplay');
    var volumeDisplay = document.querySelector('#volumeDisplay');
    updateFrequencyDisplay();
    updateOffsetDisplay();
    updateVolumeDisplay();

    function startOsc() {
        // Create OscillatorNode
        oscillatorLeft = audioContext.createOscillator();
        oscillatorRight = audioContext.createOscillator();

        // Sine wave
        oscillatorLeft.type = 0;
        oscillatorRight.type = 0;

        oscillatorLeft.frequency.value = frequency;
        oscillatorRight.frequency.value = frequency + offset;

        oscillatorLeft.start();
        oscillatorRight.start();

        // Create GainNodes
        gainLeft = audioContext.createGain();
        gainRight = audioContext.createGain();
        gainLeft.gain.value = volume / 100;
        gainRight.gain.value = volume / 100;

        // Connect the Nodes
        oscillatorLeft.connect(gainLeft).connect(panLeft).connect(audioContext.destination);
        oscillatorRight.connect(gainRight).connect(panRight).connect(audioContext.destination);
        startButton.style.display = "none";
        stopButton.style.display = "inline-block";
    };

    function off() {
        oscillatorLeft.stop();
        oscillatorRight.stop();
        gainLeft.disconnect();
        gainRight.disconnect();
        oscillatorLeft.disconnect();
        oscillatorRight.disconnect();
        startButton.style.display = "inline-block";
        stopButton.style.display = "none";
    }

    function changeFrequency(newFrequency) {
        frequency = parseInt(newFrequency);
        if (oscillatorLeft)
            oscillatorLeft.frequency.value = parseInt(frequency);
        if (oscillatorRight)
            oscillatorRight.frequency.value = parseInt(frequency) + offset;
        updateFrequencyDisplay()
    }

    function updateFrequencyDisplay() {
        frequencyLeftDisplay.innerHTML = parseInt(frequency);
        frequencyRightDisplay.innerHTML = parseInt(frequency) + offset;
    }

    function changeOffset(newOffset) {
        offset = parseInt(newOffset);
        updateOffsetDisplay();
        changeFrequency(frequency);
    }

    function updateOffsetDisplay() {
        offsetDisplay.innerHTML = parseInt(offset);
    }

    function changeVolume(newVolume) {
        volume = parseInt(newVolume);
        if (gainLeft)
            gainLeft.gain.value = volume / 100;
        if (gainRight)
            gainRight.gain.value = volume / 100;
        updateVolumeDisplay();
    }

    function updateVolumeDisplay() {
        volumeDisplay.innerHTML = parseInt(volume);
    }
</script>

</html>